# API 명세 - 쿠폰 사용 API

### 1. 개요

사용자가 발급받은 쿠폰을 주문 결제 시 사용할 수 있는 API입니다.  
쿠폰은 사용 여부를 관리하며, 이미 사용된 쿠폰은 재사용할 수 없습니다.

---

### 2. API 정보

| 항목        | 내용                                                              |
|-------------|-------------------------------------------------------------------|
| API 명칭     | 쿠폰 사용 API                                                     |
| 설명         | 사용자가 주문 결제 시 쿠폰을 사용할 수 있는 기능입니다.             |
| 관련 도메인  | Coupon, UserCoupon                                               |

---

### 3. 요청

- Method: `POST`
- Endpoint: `/coupon/{couponId}/use`

#### 3.1 Path Variable

| 변수명  | 타입   | 필수 | 설명                            |
|---------|--------|------|---------------------------------|
| couponId | Long   | ✅   | 사용할 쿠폰의 ID (고유 식별자)  |

#### 3.2 Request Body
```
{
"userId": 12345,
"orderId": 67890
}
```
| 필드명   | 타입   | 필수 | 설명                             |
|----------|--------|------|----------------------------------|
| userId   | Long   | ✅   | 쿠폰을 사용할 사용자 ID          |

---

### 4. 응답

#### 4.1 성공 시

{
"message": "쿠폰 사용이 완료되었습니다.",
"discountAmount": 1000
}

| 필드명          | 타입    | 설명                        |
|-----------------|---------|-----------------------------|
| message         | String  | 처리 결과 메시지              |
| discountAmount  | Int     | 적용된 할인 금액               |

#### 4.2 상태 코드

| 코드 | 설명           |
|------|----------------|
| 200  | 쿠폰 사용 성공  |
| 400  | 잘못된 요청    |
| 404  | 쿠폰 또는 사용자 없음 |
| 409  | 이미 사용된 쿠폰 |
| 422  | 쿠폰 유효 기간 만료 |

---

### 5. 예외 처리

| 예외 상황            | HTTP 상태 | 설명                                       |
|---------------------|------------|--------------------------------------------|
| 쿠폰 ID 오류        | 400        | 잘못된 쿠폰 ID가 전달된 경우                |
| 사용자 ID 오류      | 400        | 잘못된 사용자 ID가 전달된 경우             |
| 쿠폰 사용 여부 확인 | 409        | 이미 사용된 쿠폰을 사용하려는 경우            |
| 유효 기간 만료      | 422        | 쿠폰의 유효 기간이 만료된 경우               |
| 쿠폰 수량 초과      | 409        | 발급된 쿠폰 수량이 모두 사용된 경우          |

---

### 6. 테스트 포인트

| 테스트 항목               | 검증 내용                                                           |
|--------------------------|--------------------------------------------------------------------|
| 쿠폰 ID 확인             | 존재하지 않는 쿠폰 ID로 요청 시 404 응답이 반환되는지 확인           |
| 사용자 ID 확인           | 존재하지 않는 사용자 ID로 요청 시 404 응답이 반환되는지 확인         |
| 쿠폰 사용 처리            | 유효한 쿠폰을 정상적으로 사용할 수 있는지 확인                      |
| 이미 사용된 쿠폰 처리     | 이미 사용된 쿠폰을 사용하려고 하면 409 오류가 반환되는지 확인         |
| 쿠폰 유효 기간 확인       | 유효 기간이 만료된 쿠폰을 사용할 수 없는지 확인                       |

[돌아가기](../../README.md)