# 요구사항 분석

## 1. 기능 개요

- **상품**을 **조회**하고 **주문**할 수 있습니다.
- **최근 3일간** 가장 많이 팔린 **상품 5개**를 확인할 수 있습니다.
- 사용자는 **선착순 쿠폰**을 발급받고 이를 **주문 결제** 시 사용할 수 있습니다.
- **주문**은 기 충전된 **잔액**을 통해 결제되며, **잔액 조회**와 **충전**을 관리하는 API가 제공됩니다.

---

## 2. 기능의 요구사항

- **💰 잔액 충전 및 조회**: 사용자가 금액을 충전하고, 현재 잔액을 조회할 수 있는 기능입니다.
    - 충전 금액은 양수만 가능하고, 1회 최대 충전 금액 제한이 있을 수 있습니다.
    - 충전된 금액은 사용자의 **잔액**에 반영됩니다.
    - 잔액 조회는 사용자가 언제든지 자신의 잔액을 확인할 수 있는 기능입니다.

- **🛍️ 상품 목록 조회**: 사용자가 상품 정보를 조회할 수 있는 기능입니다.
    - 상품 목록을 조회 할 수 있다.
    - 상품의 **ID**, **이름**, **가격**, **재고** 등의 정보가 포함됩니다.

- **🎁 선착순 쿠폰 발급 및 조회**: 사용자가 쿠폰을 발급받고 조회할 수 있는 기능입니다.
    - **선착순**으로 한정된 수량의 쿠폰이 발급됩니다.
    - 쿠폰은 특정 상품에 대해 **할인율**을 적용하거나 **할인 금액**을 제공할 수 있습니다.
    - **쿠폰 사용 여부**를 관리하고, 사용된 쿠폰은 다시 사용할 수 없도록 처리됩니다.

- **💳 주문 및 결제**: 사용자가 주문하고 결제를 진행하는 기능입니다.
    - 주문 시 **상품 정보**, **수량**, **주문자 정보** 등이 포함됩니다.
    - 결제는 기 충전된 잔액을 통해 이루어지며, 부족한 잔액이 있으면 결제 실패 처리됩니다.
    - **쿠폰 사용** 시 결제 금액에 대한 **할인 혜택**을 제공합니다.

- **📊 인기 상품 통계 조회**: 판매 데이터를 바탕으로 인기 있는 상품을 조회할 수 있는 기능입니다.
    - **최근 3일** 간 가장 많이 팔린 **상품 5개**를 조회할 수 있습니다.

---

## 3. 기능의 흐름

- ### 주요 흐름:
    - **상품 조회** → **잔액 조회** → **충전** → **쿠폰 발급/사용** → **주문/결제**

- ### 상세 흐름:
    - **사용자**는 상품을 조회합니다.
    - **결제**를 진행하기 위해 **잔액 조회**를 통해 기 충전된 **잔액**을 확인합니다.
    - **사용자**가 **잔액 충전**을 요청하면 **충전**을 통해 충전이 이루어집니다.
    - **선착순 할인 쿠폰**을 발급 받습니다.
    - **주문**시 쿠폰을 사용하고 싶다면 쿠폰을 사용합니다.
    - **결제**를 요청합니다:
        - 결제 시 다음 조건들을 검증합니다:
            - [ ] 사용자의 잔액이 충분한가?
            - [ ] 상품의 재고가 충분한가?
            - [ ] 쿠폰을 사용한다면 쿠폰이 유효한가?
    - **결제 완료**됩니다:
        - 결제 후 아래 사항을 처리합니다:
            - [ ] 사용자의 잔액 차감
            - [ ] 상품의 재고 차감
            - [ ] 상품의 판매 수량 증가
            - [ ] 쿠폰 사용 시 해당 쿠폰은 사용완료로 상태 변경

---

## 4. 비기능적 요구사항 및 기술적 고려사항

- **동시성 처리**:
    - 여러 사용자가 동시에 충전하거나 주문을 진행할 수 있기 때문에, **동시성 처리**가 필요합니다.
    - **잔액**, **재고**, **쿠폰**의 동시성 문제가 발생할 수 있으며, 이를 해결하기 위해 **락(lock)** 기법이나 **트랜잭션 관리**가 필요합니다.

- **재고 정확도 보장**:
    - 상품의 **재고**는 여러 사용자가 동시에 주문할 수 있기 때문에 **정확한 재고 관리**가 필요합니다.
    - **재고 차감**은 **주문 완료** 후에 반영되며, 재고가 부족한 상품에 대한 주문은 **거절** 처리해야 합니다.

- **통계 데이터 분석을 위한 외부 전송 처리**:
    - **인기 상품** 조회 시, 판매 데이터를 외부 시스템이나 데이터 플랫폼으로 전송하여 **통계 분석**을 진행합니다.
    - **실시간 전송** 또는 **배치 처리**를 고려하여 데이터를 외부 시스템에 효율적으로 전송할 수 있어야 합니다.

[돌아가기](../README.md)